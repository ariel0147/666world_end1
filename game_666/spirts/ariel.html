<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>משחק השחקן</title>
  <style>
    body {
      margin: 0;
      background: #222;
      overflow: hidden;
    }

    .game {
      position: relative;
      width: 100vw;
      height: 100vh;
    }

    .player {
      position: absolute;
      bottom: 50px;
      left: 100px;
      width: 96px;
      height: 96px;
      background: url("spirt_image/spirt_ariel_2.png") no-repeat;
      background-size: 288px 192px;
      image-rendering: pixelated;
    }
  </style>
</head>
<body>
  <div class="game">
    <div class="player" id="player"></div>
  </div>

  <script>
    const player = document.getElementById("player");
    let x = 100;
    let y = 50;
    const groundY = 50;

    let velocityY = 0;
    const gravity = 0.3;           // גרוויטציה רכה יותר
    const jumpStrength = 7;        // קפיצה עדינה יותר
    const maxFallSpeed = -10;      // מגבלת מהירות נפילה

    let jumpCount = 0;
    const maxJumps = 2;

    let speed = 2;                 // מהירות הליכה איטית יותר
    let action = "idle";
    let frame = 0;
    let frameCounter = 0;

    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowRight") action = "walkRight";
      if (e.key === "ArrowLeft") action = "walkLeft";

      if (e.key === "ArrowUp") {
        if (jumpCount < maxJumps) {
          velocityY = jumpStrength;
          jumpCount++;
          action = "jump";
        }
      }

      if (e.key === " ") action = "action";
    });

    document.addEventListener("keyup", () => {
      if (jumpCount === 0) action = "idle";
    });

    function getFramePosition(action, frame) {
      let row = 0;
      let col = 0;

      switch (action) {
        case "walkRight":
        case "walkLeft":
          row = 1;
          col = frame % 3;
          break;
        case "jump":
          row = 1;
          col = 1;
          break;
        case "action":
          row = 0;
          col = 2;
          break;
        default:
          row = 0;
          col = 1;
          break;
      }

      return {
        x: -col * 96,
        y: -row * 96
      };
    }

    function gameLoop() {
      // תנועה אופקית
      if (action === "walkRight") {
        x += speed;
        player.style.transform = "scaleX(1)";
      }
      if (action === "walkLeft") {
        x -= speed;
        player.style.transform = "scaleX(-1)";
      }

      // גרוויטציה ודאבל קפיצה
      y += velocityY;
      velocityY -= gravity;

      if (velocityY < maxFallSpeed) {
        velocityY = maxFallSpeed;
      }

      if (y <= groundY) {
        y = groundY;
        velocityY = 0;
        jumpCount = 0;
        if (action === "jump") action = "idle";
      }

      player.style.left = x + "px";
      player.style.bottom = y + "px";

      // אנימציה
      frameCounter++;
      if (frameCounter % 10 === 0) {
        frame++;
      }

      const pos = getFramePosition(action, frame);
      player.style.backgroundPosition = `${pos.x}px ${pos.y}px`;

      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>